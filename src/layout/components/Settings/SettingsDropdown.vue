<template>
  <el-dropdown
    @command="handleProfileChange"
    trigger="click"
    class="justify-center dropdown reset-password"
  >
    <div
      class="flex items-center justify-center space-x-2 px-2 py-2 border rounded-full md:rounded-md"
      :class="
        activeDropdownItem
          ? 'text-white bg-[#344054]'
          : 'text-[#1B1B1B] border-[#D0D5DD]'
      "
    >
      <div class="md:hidden">
        <svg
          width="20"
          height="18"
          viewBox="0 0 22 20"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M10.9997 5.49998C10.1097 5.49998 9.23964 5.7639 8.49962 6.25837C7.7596 6.75284 7.18283 7.45564 6.84223 8.27791C6.50164 9.10017 6.41252 10.005 6.58616 10.8779C6.75979 11.7508 7.18837 12.5526 7.81771 13.182C8.44705 13.8113 9.24887 14.2399 10.1218 14.4135C10.9947 14.5872 11.8995 14.498 12.7218 14.1574C13.544 13.8168 14.2468 13.2401 14.7413 12.5C15.2358 11.76 15.4997 10.89 15.4997 9.99998C15.4984 8.80689 15.0239 7.66302 14.1803 6.81937C13.3367 5.97573 12.1928 5.50122 10.9997 5.49998ZM10.9997 13C10.4063 13 9.82633 12.824 9.33298 12.4944C8.83963 12.1647 8.45511 11.6962 8.22805 11.148C8.00099 10.5999 7.94158 9.99665 8.05733 9.41471C8.17309 8.83277 8.45881 8.29822 8.87837 7.87866C9.29793 7.4591 9.83248 7.17338 10.4144 7.05763C10.9964 6.94187 11.5996 7.00128 12.1477 7.22834C12.6959 7.45541 13.1645 7.83992 13.4941 8.33327C13.8237 8.82662 13.9997 9.40664 13.9997 9.99998C13.9997 10.7956 13.6836 11.5587 13.121 12.1213C12.5584 12.6839 11.7953 13 10.9997 13ZM21.3066 8.05092C21.2857 7.94531 21.2423 7.84543 21.1794 7.75807C21.1164 7.67072 21.0354 7.59793 20.9419 7.54467L18.1453 5.95092L18.1341 2.79904C18.1337 2.69049 18.1098 2.58331 18.064 2.4849C18.0182 2.38649 17.9516 2.29919 17.8688 2.22904C16.8543 1.37095 15.6861 0.713357 14.4263 0.291232C14.327 0.257651 14.2219 0.245223 14.1176 0.25475C14.0133 0.264276 13.9121 0.295546 13.8206 0.346545L10.9997 1.92342L8.17594 0.343732C8.0844 0.292446 7.98311 0.260941 7.87863 0.251251C7.77414 0.241562 7.66879 0.253905 7.56938 0.287482C6.31045 0.712692 5.14359 1.37279 4.13063 2.23279C4.04791 2.30284 3.98136 2.38999 3.93556 2.48823C3.88975 2.58647 3.86579 2.69347 3.86532 2.80186L3.85125 5.95654L1.05469 7.5503C0.961129 7.60356 0.880132 7.67634 0.817204 7.7637C0.754276 7.85105 0.710893 7.95093 0.690003 8.05654C0.434062 9.34269 0.434062 10.6667 0.690003 11.9528C0.710893 12.0584 0.754276 12.1583 0.817204 12.2456C0.880132 12.333 0.961129 12.4058 1.05469 12.459L3.85125 14.0528L3.8625 17.2047C3.86284 17.3132 3.88674 17.4204 3.93255 17.5188C3.97835 17.6172 4.04498 17.7045 4.12782 17.7747C5.14226 18.6328 6.31046 19.2904 7.57031 19.7125C7.66953 19.7461 7.77468 19.7585 7.87899 19.749C7.98329 19.7394 8.08445 19.7082 8.17594 19.6572L10.9997 18.0765L13.8234 19.6562C13.9352 19.7185 14.0611 19.7508 14.1891 19.75C14.271 19.75 14.3523 19.7367 14.43 19.7106C15.6888 19.286 16.8556 18.6265 17.8688 17.7672C17.9515 17.6971 18.018 17.61 18.0638 17.5117C18.1096 17.4135 18.1336 17.3065 18.1341 17.1981L18.1481 14.0434L20.9447 12.4497C21.0383 12.3964 21.1192 12.3236 21.1822 12.2363C21.2451 12.1489 21.2885 12.049 21.3094 11.9434C21.5639 10.6583 21.5629 9.33566 21.3066 8.05092ZM19.9003 11.3237L17.2219 12.8472C17.1045 12.9139 17.0074 13.0111 16.9406 13.1284C16.8863 13.2222 16.8291 13.3215 16.7709 13.4153C16.6965 13.5335 16.6569 13.6703 16.6566 13.81L16.6425 16.8334C15.9226 17.3988 15.1205 17.8509 14.2641 18.174L11.5622 16.6684C11.45 16.6064 11.3238 16.5741 11.1956 16.5747H11.1778C11.0644 16.5747 10.95 16.5747 10.8366 16.5747C10.7024 16.5713 10.5697 16.6037 10.4522 16.6684L7.74844 18.1778C6.89017 17.8571 6.0859 17.4072 5.36344 16.8437L5.35313 13.825C5.35266 13.685 5.31305 13.548 5.23875 13.4294C5.18063 13.3356 5.12344 13.2419 5.07 13.1425C5.00374 13.0233 4.90659 12.9242 4.78875 12.8556L2.1075 11.3284C1.96875 10.4507 1.96875 9.55672 2.1075 8.67905L4.78125 7.15279C4.89861 7.08607 4.99577 6.9889 5.0625 6.87154C5.11688 6.77779 5.17407 6.67842 5.23219 6.58467C5.30659 6.46645 5.34623 6.32967 5.34656 6.18998L5.36063 3.16654C6.08056 2.60118 6.88262 2.14909 7.73906 1.82592L10.4372 3.33154C10.5546 3.39663 10.6874 3.42901 10.8216 3.42529C10.935 3.42529 11.0494 3.42529 11.1628 3.42529C11.297 3.42865 11.4296 3.39629 11.5472 3.33154L14.2509 1.82217C15.1092 2.14286 15.9135 2.59274 16.6359 3.15623L16.6463 6.17498C16.6467 6.31495 16.6863 6.45199 16.7606 6.57061C16.8188 6.66436 16.8759 6.75811 16.9294 6.85748C16.9956 6.97665 17.0928 7.07575 17.2106 7.14436L19.8919 8.67155C20.0325 9.54989 20.0341 10.4449 19.8966 11.3237H19.9003Z"
            fill="black"
          />
          <path
            d="M10.9997 5.49998C10.1097 5.49998 9.23964 5.7639 8.49962 6.25837C7.7596 6.75284 7.18283 7.45564 6.84223 8.27791C6.50164 9.10017 6.41252 10.005 6.58616 10.8779C6.75979 11.7508 7.18837 12.5526 7.81771 13.182C8.44705 13.8113 9.24887 14.2399 10.1218 14.4135C10.9947 14.5872 11.8995 14.498 12.7218 14.1574C13.544 13.8168 14.2468 13.2401 14.7413 12.5C15.2358 11.76 15.4997 10.89 15.4997 9.99998C15.4984 8.80689 15.0239 7.66302 14.1803 6.81937C13.3367 5.97573 12.1928 5.50122 10.9997 5.49998ZM10.9997 13C10.4063 13 9.82633 12.824 9.33298 12.4944C8.83963 12.1647 8.45511 11.6962 8.22805 11.148C8.00099 10.5999 7.94158 9.99665 8.05733 9.41471C8.17309 8.83277 8.45881 8.29822 8.87837 7.87866C9.29793 7.4591 9.83248 7.17338 10.4144 7.05763C10.9964 6.94187 11.5996 7.00128 12.1477 7.22834C12.6959 7.45541 13.1645 7.83992 13.4941 8.33327C13.8237 8.82662 13.9997 9.40664 13.9997 9.99998C13.9997 10.7956 13.6836 11.5587 13.121 12.1213C12.5584 12.6839 11.7953 13 10.9997 13ZM21.3066 8.05092C21.2857 7.94531 21.2423 7.84543 21.1794 7.75807C21.1164 7.67072 21.0354 7.59793 20.9419 7.54467L18.1453 5.95092L18.1341 2.79904C18.1337 2.69049 18.1098 2.58331 18.064 2.4849C18.0182 2.38649 17.9516 2.29919 17.8688 2.22904C16.8543 1.37095 15.6861 0.713357 14.4263 0.291232C14.327 0.257651 14.2219 0.245223 14.1176 0.25475C14.0133 0.264276 13.9121 0.295546 13.8206 0.346545L10.9997 1.92342L8.17594 0.343732C8.0844 0.292446 7.98311 0.260941 7.87863 0.251251C7.77414 0.241562 7.66879 0.253905 7.56938 0.287482C6.31045 0.712692 5.14359 1.37279 4.13063 2.23279C4.04791 2.30284 3.98136 2.38999 3.93556 2.48823C3.88975 2.58647 3.86579 2.69347 3.86532 2.80186L3.85125 5.95654L1.05469 7.5503C0.961129 7.60356 0.880132 7.67634 0.817204 7.7637C0.754276 7.85105 0.710893 7.95093 0.690003 8.05654C0.434062 9.34269 0.434062 10.6667 0.690003 11.9528C0.710893 12.0584 0.754276 12.1583 0.817204 12.2456C0.880132 12.333 0.961129 12.4058 1.05469 12.459L3.85125 14.0528L3.8625 17.2047C3.86284 17.3132 3.88674 17.4204 3.93255 17.5188C3.97835 17.6172 4.04498 17.7045 4.12782 17.7747C5.14226 18.6328 6.31046 19.2904 7.57031 19.7125C7.66953 19.7461 7.77468 19.7585 7.87899 19.749C7.98329 19.7394 8.08445 19.7082 8.17594 19.6572L10.9997 18.0765L13.8234 19.6562C13.9352 19.7185 14.0611 19.7508 14.1891 19.75C14.271 19.75 14.3523 19.7367 14.43 19.7106C15.6888 19.286 16.8556 18.6265 17.8688 17.7672C17.9515 17.6971 18.018 17.61 18.0638 17.5117C18.1096 17.4135 18.1336 17.3065 18.1341 17.1981L18.1481 14.0434L20.9447 12.4497C21.0383 12.3964 21.1192 12.3236 21.1822 12.2363C21.2451 12.1489 21.2885 12.049 21.3094 11.9434C21.5639 10.6583 21.5629 9.33566 21.3066 8.05092ZM19.9003 11.3237L17.2219 12.8472C17.1045 12.9139 17.0074 13.0111 16.9406 13.1284C16.8863 13.2222 16.8291 13.3215 16.7709 13.4153C16.6965 13.5335 16.6569 13.6703 16.6566 13.81L16.6425 16.8334C15.9226 17.3988 15.1205 17.8509 14.2641 18.174L11.5622 16.6684C11.45 16.6064 11.3238 16.5741 11.1956 16.5747H11.1778C11.0644 16.5747 10.95 16.5747 10.8366 16.5747C10.7024 16.5713 10.5697 16.6037 10.4522 16.6684L7.74844 18.1778C6.89017 17.8571 6.0859 17.4072 5.36344 16.8437L5.35313 13.825C5.35266 13.685 5.31305 13.548 5.23875 13.4294C5.18063 13.3356 5.12344 13.2419 5.07 13.1425C5.00374 13.0233 4.90659 12.9242 4.78875 12.8556L2.1075 11.3284C1.96875 10.4507 1.96875 9.55672 2.1075 8.67905L4.78125 7.15279C4.89861 7.08607 4.99577 6.9889 5.0625 6.87154C5.11688 6.77779 5.17407 6.67842 5.23219 6.58467C5.30659 6.46645 5.34623 6.32967 5.34656 6.18998L5.36063 3.16654C6.08056 2.60118 6.88262 2.14909 7.73906 1.82592L10.4372 3.33154C10.5546 3.39663 10.6874 3.42901 10.8216 3.42529C10.935 3.42529 11.0494 3.42529 11.1628 3.42529C11.297 3.42865 11.4296 3.39629 11.5472 3.33154L14.2509 1.82217C15.1092 2.14286 15.9135 2.59274 16.6359 3.15623L16.6463 6.17498C16.6467 6.31495 16.6863 6.45199 16.7606 6.57061C16.8188 6.66436 16.8759 6.75811 16.9294 6.85748C16.9956 6.97665 17.0928 7.07575 17.2106 7.14436L19.8919 8.67155C20.0325 9.54989 20.0341 10.4449 19.8966 11.3237H19.9003Z"
            fill="black"
            fill-opacity="0.2"
          />
          <path
            d="M10.9997 5.49998C10.1097 5.49998 9.23964 5.7639 8.49962 6.25837C7.7596 6.75284 7.18283 7.45564 6.84223 8.27791C6.50164 9.10017 6.41252 10.005 6.58616 10.8779C6.75979 11.7508 7.18837 12.5526 7.81771 13.182C8.44705 13.8113 9.24887 14.2399 10.1218 14.4135C10.9947 14.5872 11.8995 14.498 12.7218 14.1574C13.544 13.8168 14.2468 13.2401 14.7413 12.5C15.2358 11.76 15.4997 10.89 15.4997 9.99998C15.4984 8.80689 15.0239 7.66302 14.1803 6.81937C13.3367 5.97573 12.1928 5.50122 10.9997 5.49998ZM10.9997 13C10.4063 13 9.82633 12.824 9.33298 12.4944C8.83963 12.1647 8.45511 11.6962 8.22805 11.148C8.00099 10.5999 7.94158 9.99665 8.05733 9.41471C8.17309 8.83277 8.45881 8.29822 8.87837 7.87866C9.29793 7.4591 9.83248 7.17338 10.4144 7.05763C10.9964 6.94187 11.5996 7.00128 12.1477 7.22834C12.6959 7.45541 13.1645 7.83992 13.4941 8.33327C13.8237 8.82662 13.9997 9.40664 13.9997 9.99998C13.9997 10.7956 13.6836 11.5587 13.121 12.1213C12.5584 12.6839 11.7953 13 10.9997 13ZM21.3066 8.05092C21.2857 7.94531 21.2423 7.84543 21.1794 7.75807C21.1164 7.67072 21.0354 7.59793 20.9419 7.54467L18.1453 5.95092L18.1341 2.79904C18.1337 2.69049 18.1098 2.58331 18.064 2.4849C18.0182 2.38649 17.9516 2.29919 17.8688 2.22904C16.8543 1.37095 15.6861 0.713357 14.4263 0.291232C14.327 0.257651 14.2219 0.245223 14.1176 0.25475C14.0133 0.264276 13.9121 0.295546 13.8206 0.346545L10.9997 1.92342L8.17594 0.343732C8.0844 0.292446 7.98311 0.260941 7.87863 0.251251C7.77414 0.241562 7.66879 0.253905 7.56938 0.287482C6.31045 0.712692 5.14359 1.37279 4.13063 2.23279C4.04791 2.30284 3.98136 2.38999 3.93556 2.48823C3.88975 2.58647 3.86579 2.69347 3.86532 2.80186L3.85125 5.95654L1.05469 7.5503C0.961129 7.60356 0.880132 7.67634 0.817204 7.7637C0.754276 7.85105 0.710893 7.95093 0.690003 8.05654C0.434062 9.34269 0.434062 10.6667 0.690003 11.9528C0.710893 12.0584 0.754276 12.1583 0.817204 12.2456C0.880132 12.333 0.961129 12.4058 1.05469 12.459L3.85125 14.0528L3.8625 17.2047C3.86284 17.3132 3.88674 17.4204 3.93255 17.5188C3.97835 17.6172 4.04498 17.7045 4.12782 17.7747C5.14226 18.6328 6.31046 19.2904 7.57031 19.7125C7.66953 19.7461 7.77468 19.7585 7.87899 19.749C7.98329 19.7394 8.08445 19.7082 8.17594 19.6572L10.9997 18.0765L13.8234 19.6562C13.9352 19.7185 14.0611 19.7508 14.1891 19.75C14.271 19.75 14.3523 19.7367 14.43 19.7106C15.6888 19.286 16.8556 18.6265 17.8688 17.7672C17.9515 17.6971 18.018 17.61 18.0638 17.5117C18.1096 17.4135 18.1336 17.3065 18.1341 17.1981L18.1481 14.0434L20.9447 12.4497C21.0383 12.3964 21.1192 12.3236 21.1822 12.2363C21.2451 12.1489 21.2885 12.049 21.3094 11.9434C21.5639 10.6583 21.5629 9.33566 21.3066 8.05092ZM19.9003 11.3237L17.2219 12.8472C17.1045 12.9139 17.0074 13.0111 16.9406 13.1284C16.8863 13.2222 16.8291 13.3215 16.7709 13.4153C16.6965 13.5335 16.6569 13.6703 16.6566 13.81L16.6425 16.8334C15.9226 17.3988 15.1205 17.8509 14.2641 18.174L11.5622 16.6684C11.45 16.6064 11.3238 16.5741 11.1956 16.5747H11.1778C11.0644 16.5747 10.95 16.5747 10.8366 16.5747C10.7024 16.5713 10.5697 16.6037 10.4522 16.6684L7.74844 18.1778C6.89017 17.8571 6.0859 17.4072 5.36344 16.8437L5.35313 13.825C5.35266 13.685 5.31305 13.548 5.23875 13.4294C5.18063 13.3356 5.12344 13.2419 5.07 13.1425C5.00374 13.0233 4.90659 12.9242 4.78875 12.8556L2.1075 11.3284C1.96875 10.4507 1.96875 9.55672 2.1075 8.67905L4.78125 7.15279C4.89861 7.08607 4.99577 6.9889 5.0625 6.87154C5.11688 6.77779 5.17407 6.67842 5.23219 6.58467C5.30659 6.46645 5.34623 6.32967 5.34656 6.18998L5.36063 3.16654C6.08056 2.60118 6.88262 2.14909 7.73906 1.82592L10.4372 3.33154C10.5546 3.39663 10.6874 3.42901 10.8216 3.42529C10.935 3.42529 11.0494 3.42529 11.1628 3.42529C11.297 3.42865 11.4296 3.39629 11.5472 3.33154L14.2509 1.82217C15.1092 2.14286 15.9135 2.59274 16.6359 3.15623L16.6463 6.17498C16.6467 6.31495 16.6863 6.45199 16.7606 6.57061C16.8188 6.66436 16.8759 6.75811 16.9294 6.85748C16.9956 6.97665 17.0928 7.07575 17.2106 7.14436L19.8919 8.67155C20.0325 9.54989 20.0341 10.4449 19.8966 11.3237H19.9003Z"
            fill="black"
            fill-opacity="0.2"
          />
        </svg>
      </div>
      <SvgIcon
        class="svg-desktop hidden md:block"
        name="local-tool"
        color="transparent"
        size="22"
        :stroke="activeDropdownItem ? 'white' : '#344054'"
      />
      <span class="desktop-drop font-semibold text-sm">{{
        activeDropdownItem || "Settings"
      }}</span>
      <div class="hidden md:block">
        <ArrowDownIcon v-if="activeDropdownItem" classes="w-3 fill-white" />
        <ArrowDownIcon v-else classes="w-3 fill-[#1B1B1B]" />
      </div>
    </div>
    <template #dropdown>
      <el-dropdown-menu>
        <el-popover
          :visible="visibleProfile"
          placement="bottom"
          :width="240"
          class="hidden md:block"
        >
          <div
            class="flex-col gap-2 items-start p-3 hidden md:block"
            ref="excludeRef"
          >
            <h1 class="font-bold text-lg">
              {{ store.getUser?.first_name + " " + store.getUser?.last_name }}
            </h1>
            <h1 class="font-bold text-lg text-[#92929D]">
              {{ store.getUser?.role }}
            </h1>
            <h1 class="font-bold text-lg text-[#92929D]">
              {{ store.getUser?.email }}
            </h1>
            <el-button
              size="large"
              type="primary"
              class="self-center mt-2 w-32"
              @click="visibleProfile = false"
              >Close</el-button
            >
          </div>
          <template #reference>
            <div
              class="el-dropdown-menu__item hover:bg-[#f0ecf9] font-medium items-center gap-2 hover:text-primary"
              @click="visibleProfile = true"
              ref="componentRef"
            >
              <svg
                width="16"
                height="16"
                viewBox="0 0 16 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M14.4329 13.2497C13.481 11.6041 12.0142 10.4241 10.3023 9.86475C11.1491 9.36066 11.8069 8.59255 12.1749 7.67837C12.5429 6.76419 12.6006 5.7545 12.3392 4.80435C12.0778 3.85419 11.5117 3.01612 10.7279 2.41883C9.94408 1.82153 8.98587 1.49805 8.00041 1.49805C7.01496 1.49805 6.05675 1.82153 5.27293 2.41883C4.48911 3.01612 3.92304 3.85419 3.66163 4.80435C3.40022 5.7545 3.45793 6.76419 3.82591 7.67837C4.19388 8.59255 4.85177 9.36066 5.69854 9.86475C3.98666 10.4235 2.51979 11.6035 1.56791 13.2497C1.53301 13.3067 1.50985 13.37 1.49982 13.436C1.48978 13.502 1.49307 13.5694 1.50949 13.6341C1.52591 13.6988 1.55512 13.7596 1.59541 13.8128C1.63569 13.8661 1.68624 13.9107 1.74405 13.9441C1.80187 13.9775 1.86579 13.999 1.93204 14.0073C1.9983 14.0156 2.06554 14.0105 2.1298 13.9924C2.19407 13.9743 2.25405 13.9435 2.30622 13.9018C2.35838 13.8601 2.40168 13.8084 2.43354 13.7497C3.61104 11.7147 5.69229 10.4997 8.00041 10.4997C10.3085 10.4997 12.3898 11.7147 13.5673 13.7497C13.5992 13.8084 13.6424 13.8601 13.6946 13.9018C13.7468 13.9435 13.8068 13.9743 13.871 13.9924C13.9353 14.0105 14.0025 14.0156 14.0688 14.0073C14.135 13.999 14.199 13.9775 14.2568 13.9441C14.3146 13.9107 14.3651 13.8661 14.4054 13.8128C14.4457 13.7596 14.4749 13.6988 14.4913 13.6341C14.5078 13.5694 14.511 13.502 14.501 13.436C14.491 13.37 14.4678 13.3067 14.4329 13.2497ZM4.50041 5.99975C4.50041 5.30751 4.70569 4.63082 5.09027 4.05525C5.47485 3.47968 6.02148 3.03108 6.66102 2.76617C7.30056 2.50126 8.0043 2.43195 8.68323 2.567C9.36216 2.70205 9.9858 3.03539 10.4753 3.52487C10.9648 4.01436 11.2981 4.638 11.4332 5.31693C11.5682 5.99586 11.4989 6.6996 11.234 7.33914C10.9691 7.97868 10.5205 8.52531 9.94491 8.90989C9.36934 9.29448 8.69265 9.49975 8.00041 9.49975C7.07246 9.49875 6.1828 9.12969 5.52664 8.47353C4.87047 7.81736 4.50141 6.9277 4.50041 5.99975Z"
                  fill="#343330"
                />
              </svg>
              <span class="font-medium text-black">Profile info</span>
            </div>
          </template>
        </el-popover>

        <el-dropdown-item divided command="academic">
          <div class="!font-medium !text-black flex items-center gap-2">
            <SvgIcon
              name="local-graduation"
              color="transparent"
              stroke="black"
              size="18"
            />
            <span>Academic settings</span>
          </div>
        </el-dropdown-item>
        <el-dropdown-item command="masterdata">
          <div class="!font-medium !text-black flex items-center gap-2">
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M13.98 4.13414L8.48 1.12477C8.33305 1.04357 8.16789 1.00098 8 1.00098C7.83211 1.00098 7.66695 1.04357 7.52 1.12477L2.02 4.13539C1.86293 4.22133 1.73181 4.34787 1.64034 4.50178C1.54888 4.6557 1.50041 4.83135 1.5 5.01039V10.9879C1.50041 11.1669 1.54888 11.3426 1.64034 11.4965C1.73181 11.6504 1.86293 11.777 2.02 11.8629L7.52 14.8735C7.66695 14.9547 7.83211 14.9973 8 14.9973C8.16789 14.9973 8.33305 14.9547 8.48 14.8735L13.98 11.8629C14.1371 11.777 14.2682 11.6504 14.3597 11.4965C14.4511 11.3426 14.4996 11.1669 14.5 10.9879V5.01102C14.4999 4.83166 14.4516 4.65561 14.3601 4.50134C14.2686 4.34706 14.1373 4.22024 13.98 4.13414ZM8 1.99977L13.0212 4.74977L8 7.49977L2.97875 4.74977L8 1.99977ZM2.5 5.62477L7.5 8.36102V13.7229L2.5 10.9885V5.62477ZM8.5 13.7229V8.36352L13.5 5.62477V10.986L8.5 13.7229Z"
                fill="#343330"
              />
            </svg>
            <span>Master data settings</span>
          </div>
        </el-dropdown-item>
        <el-dropdown-item
          divided
          command="certificates"
          v-if="route.path.includes('academic')"
        >
          <div class="!font-medium !text-black flex items-center gap-2">
            <svg
              width="18"
              height="18"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M13.3538 5.14625L9.85375 1.64625C9.80728 1.59983 9.75212 1.56303 9.69143 1.53793C9.63073 1.51284 9.56568 1.49995 9.5 1.5H3.5C3.23478 1.5 2.98043 1.60536 2.79289 1.79289C2.60536 1.98043 2.5 2.23478 2.5 2.5V13.5C2.5 13.7652 2.60536 14.0196 2.79289 14.2071C2.98043 14.3946 3.23478 14.5 3.5 14.5H12.5C12.7652 14.5 13.0196 14.3946 13.2071 14.2071C13.3946 14.0196 13.5 13.7652 13.5 13.5V5.5C13.5001 5.43432 13.4872 5.36927 13.4621 5.30858C13.437 5.24788 13.4002 5.19272 13.3538 5.14625ZM10 3.20688L11.7931 5H10V3.20688ZM12.5 13.5H3.5V2.5H9V5.5C9 5.63261 9.05268 5.75979 9.14645 5.85355C9.24021 5.94732 9.36739 6 9.5 6H12.5V13.5ZM10.5 8.5C10.5 8.63261 10.4473 8.75979 10.3536 8.85355C10.2598 8.94732 10.1326 9 10 9H6C5.86739 9 5.74021 8.94732 5.64645 8.85355C5.55268 8.75979 5.5 8.63261 5.5 8.5C5.5 8.36739 5.55268 8.24021 5.64645 8.14645C5.74021 8.05268 5.86739 8 6 8H10C10.1326 8 10.2598 8.05268 10.3536 8.14645C10.4473 8.24021 10.5 8.36739 10.5 8.5ZM10.5 10.5C10.5 10.6326 10.4473 10.7598 10.3536 10.8536C10.2598 10.9473 10.1326 11 10 11H6C5.86739 11 5.74021 10.9473 5.64645 10.8536C5.55268 10.7598 5.5 10.6326 5.5 10.5C5.5 10.3674 5.55268 10.2402 5.64645 10.1464C5.74021 10.0527 5.86739 10 6 10H10C10.1326 10 10.2598 10.0527 10.3536 10.1464C10.4473 10.2402 10.5 10.3674 10.5 10.5Z"
                fill="#343330"
                stroke-width="2"
              />
            </svg>
            <span>Certificates history</span>
          </div>
        </el-dropdown-item>
        <!-- <el-dropdown-item command="change-password"
          >Change password</el-dropdown-item
        > -->
        <el-menu class="setting-menu">
          <el-sub-menu index="1" class="!pl-0">
            <template #title>
              <div
                class="!font-medium !text-black flex items-center gap-2 relative -left-[1px]"
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 16 16"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M13.3538 5.14625L9.85375 1.64625C9.80728 1.59983 9.75212 1.56303 9.69143 1.53793C9.63073 1.51284 9.56568 1.49995 9.5 1.5H3.5C3.23478 1.5 2.98043 1.60536 2.79289 1.79289C2.60536 1.98043 2.5 2.23478 2.5 2.5V13.5C2.5 13.7652 2.60536 14.0196 2.79289 14.2071C2.98043 14.3946 3.23478 14.5 3.5 14.5H12.5C12.7652 14.5 13.0196 14.3946 13.2071 14.2071C13.3946 14.0196 13.5 13.7652 13.5 13.5V5.5C13.5001 5.43432 13.4872 5.36927 13.4621 5.30858C13.437 5.24788 13.4002 5.19272 13.3538 5.14625ZM10 3.20688L11.7931 5H10V3.20688ZM12.5 13.5H3.5V2.5H9V5.5C9 5.63261 9.05268 5.75979 9.14645 5.85355C9.24021 5.94732 9.36739 6 9.5 6H12.5V13.5ZM10.5 8.5C10.5 8.63261 10.4473 8.75979 10.3536 8.85355C10.2598 8.94732 10.1326 9 10 9H6C5.86739 9 5.74021 8.94732 5.64645 8.85355C5.55268 8.75979 5.5 8.63261 5.5 8.5C5.5 8.36739 5.55268 8.24021 5.64645 8.14645C5.74021 8.05268 5.86739 8 6 8H10C10.1326 8 10.2598 8.05268 10.3536 8.14645C10.4473 8.24021 10.5 8.36739 10.5 8.5ZM10.5 10.5C10.5 10.6326 10.4473 10.7598 10.3536 10.8536C10.2598 10.9473 10.1326 11 10 11H6C5.86739 11 5.74021 10.9473 5.64645 10.8536C5.55268 10.7598 5.5 10.6326 5.5 10.5C5.5 10.3674 5.55268 10.2402 5.64645 10.1464C5.74021 10.0527 5.86739 10 6 10H10C10.1326 10 10.2598 10.0527 10.3536 10.1464C10.4473 10.2402 10.5 10.3674 10.5 10.5Z"
                    fill="#343330"
                    stroke-width="2"
                  />
                </svg>
                <span>University Profile</span>
              </div>
            </template>
            <el-menu-item index="1-1" @click="upenLogoModal"
              >Set University Logo</el-menu-item
            >
            <el-menu-item index="1-2" @click="router.push({ name: 'staffs' })"
              >Manage admin users</el-menu-item
            >
          </el-sub-menu>
        </el-menu>
        <el-dropdown-item command="logout">
          <div class="!font-medium !text-black flex items-center gap-2">
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M7 13.5C7 13.6326 6.94732 13.7598 6.85355 13.8536C6.75979 13.9473 6.63261 14 6.5 14H3C2.73478 14 2.48043 13.8946 2.29289 13.7071C2.10536 13.5196 2 13.2652 2 13V3C2 2.73478 2.10536 2.48043 2.29289 2.29289C2.48043 2.10536 2.73478 2 3 2H6.5C6.63261 2 6.75979 2.05268 6.85355 2.14645C6.94732 2.24021 7 2.36739 7 2.5C7 2.63261 6.94732 2.75979 6.85355 2.85355C6.75979 2.94732 6.63261 3 6.5 3H3V13H6.5C6.63261 13 6.75979 13.0527 6.85355 13.1464C6.94732 13.2402 7 13.3674 7 13.5ZM13.8538 7.64625L11.3538 5.14625C11.2599 5.05243 11.1327 4.99972 11 4.99972C10.8673 4.99972 10.7401 5.05243 10.6462 5.14625C10.5524 5.24007 10.4997 5.36732 10.4997 5.5C10.4997 5.63268 10.5524 5.75993 10.6462 5.85375L12.2931 7.5H6.5C6.36739 7.5 6.24021 7.55268 6.14645 7.64645C6.05268 7.74021 6 7.86739 6 8C6 8.13261 6.05268 8.25979 6.14645 8.35355C6.24021 8.44732 6.36739 8.5 6.5 8.5H12.2931L10.6462 10.1462C10.5524 10.2401 10.4997 10.3673 10.4997 10.5C10.4997 10.6327 10.5524 10.7599 10.6462 10.8538C10.7401 10.9476 10.8673 11.0003 11 11.0003C11.1327 11.0003 11.2599 10.9476 11.3538 10.8538L13.8538 8.35375C13.9002 8.30731 13.9371 8.25217 13.9623 8.19147C13.9874 8.13077 14.0004 8.06571 14.0004 8C14.0004 7.93429 13.9874 7.86923 13.9623 7.80853C13.9371 7.74783 13.9002 7.69269 13.8538 7.64625Z"
                fill="#343330"
              />
            </svg>
            <span>Log out</span>
          </div>
        </el-dropdown-item>
      </el-dropdown-menu>
    </template>
  </el-dropdown>
  <el-dialog
    v-model="showResetModal"
    title="Change password"
    :width="350"
    class="reset"
  >
    <ResetPassword @on-update="showResetModal = false" />
  </el-dialog>
  <el-dialog v-model="showLogoModal" :width="450" class="reset">
    <SetLogo @on-usert="showLogoModal = false" />
  </el-dialog>
</template>

<script setup lang="ts">
import ResetPassword from "./components/ResetPassword.vue";
import importPayment from "./components/importPayment.vue";
import { ArrowDownIcon } from "@/components/icons";
import SettingsIcons from "../../../assets/images/settings.svg";
import SettingIcon from "@/components/icons/SettingIcon.vue";
import { ElMessageBox } from "element-plus";
import { useI18n } from "vue-i18n";
import { useUsersStore } from "@/stores/user";
import { useRoute, useRouter } from "vue-router";
import { onMounted, ref, watch } from "vue";
import SetLogo from "./components/SetLogo.vue";

const props = defineProps<{
  theme?: "light" | "dark";
}>();

const store = useUsersStore();
const I18n = useI18n();
const router = useRouter();
const route = useRoute();

const visibleProfile = ref(false);
const showResetModal = ref(false);
const showPaymentModal = ref(false);
const showLogoModal = ref(false);
const activeDropdownItem = ref(null);

const componentRef = ref();
const excludeRef = ref();

useClickOutside(
  componentRef,
  () => {
    visibleProfile.value = false;
  },
  excludeRef
);

//dropdown
function useClickOutside(component: any, callback: any, excludeComponent: any) {
  // if (!component) {
  //   throw new Error("A target component has to be provided.");
  // }

  // if (!callback) {
  //   throw new Error("A callback has to be provided.");
  // }

  function listener(event: Event) {
    if (
      event.target === component.value ||
      event.composedPath().includes(component.value) ||
      event.target === excludeComponent.value ||
      event.composedPath().includes(excludeComponent.value)
    ) {
      return;
    }
    if (typeof callback === "function") {
      callback();
    }
  }
  onMounted(() => {
    window.addEventListener("click", listener);
  });
}
//dropdown
onMounted(() => {
  checkDropdown();
});

const handleProfileChange = (command: string) => {
  if (command === "logout") {
    ElMessageBox.confirm(I18n.t("app.doYouwantLogOut"), I18n.t("app.warning"), {
      confirmButtonText: I18n.t("shared.yes"),
      cancelButtonText: I18n.t("shared.cancel"),
      type: "warning",
    }).then(() => {
      store.resetToken();
      router.push(`/login?redirect=${route.fullPath}`);
    });
  }
  if (command === "profile") {
    visibleProfile.value = true;
  }
  if (command === "payments") {
    showPaymentModal.value = true;
  }
  if (command === "change-password") {
    showResetModal.value = true;
  }
  if (command === "programs") {
    router.push("/academic/schools");
  }
  if (command === "certificates") {
    router.push("/academic/certificates-history");
  }
  if (command === "referance") {
    router.push("/academic/reference");
  }
  if (command === "masterdata") {
    router.push("/academic/reference/masterdata");
  }
  if (command === "academic") {
    router.push("/academic/reference");
  }
};

const dropdownNames = {
  academic: "Academic settings",
  masterdata: "Master data settings",
} as any;
const upenLogoModal = () => {
  showLogoModal.value = true;
};

watch(
  () => route.name,
  () => {
    checkDropdown();
  }
);

const checkDropdown = () => {
  if (Object.keys(dropdownNames).find((key) => key === route.meta?.name)) {
    activeDropdownItem.value = dropdownNames[route.meta?.name as string];
  } else {
    activeDropdownItem.value = null;
  }
};
</script>

<style scoped lang="scss">
.dropdown {
  .dark {
    background-color: #ffffff !important;
  }
}
</style>
<style>
.el-dialog.reset {
  background-color: #fff !important;
}

@media (min-width: 600px) {
  .mobile-drop {
    display: none;
  }

  .svg-mobile {
    display: none;
  }
}

@media (max-width: 600px) {
  .desktop-drop {
    display: none;
  }

  .svg-desktop {
    display: none;
  }
}
</style>
